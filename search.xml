<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>frp内网穿透搭建</title>
      <link href="/2020/07/31/frp%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%90%AD%E5%BB%BA/"/>
      <url>/2020/07/31/frp%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>&emsp;&emsp;由于公司的ngrok开源版三天两头就挂掉，并且ngrok开源版已经停止维护了，所以我决定更换公司的内网穿透工具，经过一番查找，发现frp符合我的需求，在此记录一下frp搭建的过程<br>&emsp;&emsp;本文主要讲解如何搭建frp内网穿透，及如何配合nginx实现配置多个子域名访问内部服务，故本文只介绍如何安装配置frp，本文默认您已掌握nginx的安装及使用方法</p><h1 id="frp介绍"><a href="#frp介绍" class="headerlink" title="frp介绍"></a>frp介绍</h1><p>&emsp;&emsp;frp 是一个可用于内网穿透的高性能的反向代理应用，支持 tcp, udp 协议，为 http 和 https 应用协议提供了额外的能力，且尝试性支持了点对点穿透</p><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><ol><li>可以上网的电脑</li><li>带公网ip的服务器</li><li>已备案的域名</li><li>frp <a href="https://github.com/fatedier/frp/releases">下载地址</a></li><li>nginx <a href="http://nginx.org/en/download.html">下载地址</a></li></ol><h1 id="安装frp"><a href="#安装frp" class="headerlink" title="安装frp"></a>安装frp</h1><p>&emsp;&emsp;下载完frp压缩包后，打开会发现frpc文件夹和frps文件夹，frpc是客户端，安装在内网机器上，frps是服务端，安装在具有公网ip的服务器上</p><h1 id="配置frps服务端"><a href="#配置frps服务端" class="headerlink" title="配置frps服务端"></a>配置frps服务端</h1><h2 id="编辑frps-ini"><a href="#编辑frps-ini" class="headerlink" title="编辑frps.ini"></a>编辑frps.ini</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="comment"># frp连接的端口</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># http监听端口</span></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">8080</span></span><br><span class="line"><span class="comment"># https监听端口</span></span><br><span class="line"><span class="attr">vhost_https_port</span> = <span class="number">8443</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># frp客户端连接服务端时的token 为了安全 建议添加</span></span><br><span class="line"><span class="attr">token</span> = tPaALZKtCBfN6IAp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 二级域名 后面访问的格式是a.frp.xxx.net或b.frp.xxx.net</span></span><br><span class="line"><span class="attr">subdomain_host</span> = frp.xxx.net</span><br></pre></td></tr></table></figure><h2 id="启动frps"><a href="#启动frps" class="headerlink" title="启动frps"></a>启动frps</h2><p><code>./frps -c ./frps.ini</code></p><h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><p>将<code>frp.xxx.net</code>和<code>*.frp.xxx.net</code>指向你的服务器公网ip，并测试是否解析成功</p><h1 id="配置frpc客户端"><a href="#配置frpc客户端" class="headerlink" title="配置frpc客户端"></a>配置frpc客户端</h1><h2 id="编辑frpc-ini"><a href="#编辑frpc-ini" class="headerlink" title="编辑frpc.ini"></a>编辑frpc.ini</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="comment"># 公网ip 就是frps所在的服务器的ip</span></span><br><span class="line"><span class="attr">server_addr</span> = xxx.xxx.xxx.xxx</span><br><span class="line"><span class="comment"># frps规定的连接端口</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="comment"># 连接token 与frps中的token</span></span><br><span class="line"><span class="attr">token</span> = tPaALZKtCBfN6isP</span><br><span class="line"><span class="comment"># 定义第一个转发</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="comment"># 本地ssh端口</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="comment"># 远程访问ssh端口</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[web01]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="comment"># 本地(内网)服务的端口</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">8001</span></span><br><span class="line"><span class="comment"># 与frps中的subdomain_host连接起来就是a.frp.xxx.net</span></span><br><span class="line"><span class="attr">subdomain</span> = a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义第二个转发</span></span><br><span class="line"><span class="section">[web02]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="comment"># 本地(内网)服务的端口</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">8002</span></span><br><span class="line"><span class="comment"># 与frps中的subdomain_host连接起来就是b.frp.xxx.net</span></span><br><span class="line"><span class="attr">subdomain</span> = b</span><br></pre></td></tr></table></figure><h2 id="启动frpc"><a href="#启动frpc" class="headerlink" title="启动frpc"></a>启动frpc</h2><p><code>./frpc -c ./frpc.ini</code></p><h1 id="配置nginx转发"><a href="#配置nginx转发" class="headerlink" title="配置nginx转发"></a>配置nginx转发</h1><p>编辑nginx.conf</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="comment"># 监听的80端口</span></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="comment"># 域名配置 记得一定要加上*.frp.xxx.net这个，只加frp.xxx.net是不行的</span></span><br><span class="line">    <span class="attribute">server_name</span> * .frp.xxx.net frp.xxx.net;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http: //<span class="number">127.0.0.1:8080</span>;</span><br><span class="line">        <span class="comment"># 这个Host的header一定要加，不然转发后frp拿不到通过哪个域名访问的，导致转发失败</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后重启nginx，至此配置结束，输入xxx.frp.xxx.net开启你的内网穿透之旅吧！</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> 内网穿透 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
